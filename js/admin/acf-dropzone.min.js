!function(e,o){var s=wp.media.View.extend({tagName:"div",className:"acf-dropzone-info",template:wp.template("acf-dropzone-info")}),t=Backbone.View.extend({tagName:"div",className:"media-progress-bar-box",render:function(){return this.$progress=e("<div />").addClass("media-progress-bar"),this.$label=e("<div />").addClass("media-progress-label"),this.$bar=e("<div />"),this.$el.append(this.$label),this.$progress.append(this.$bar).appendTo(this.$el),this},setLabel:function(e){this.$label.text(e)},setProgress:function(e){return this.$bar.width(e+"%"),this}}),i=wp.media.View.extend({template:wp.template("acf-dropzone-notice"),className:"notice is-dismissible",events:{"click .notice-dismiss":"remove"},render:function(){wp.media.View.prototype.render.apply(this,arguments),this.$el.addClass(this.options.type)}}),r=Backbone.View.extend({events:{focus:"listenPaste",blur:"stopListenPaste"},listenPaste:function(e){var t=this;this.$el.on("paste",function(){t.onPaste.apply(t,arguments)})},stopListenPaste:function(){this.$el.off("paste")},initialize:function(e){return Backbone.View.prototype.initialize.apply(this,arguments),this.controller=e.controller,this},render:function(){return this.$el.attr("tabindex","-1"),this},onPaste:function(e){e.preventDefault(),e.stopPropagation();var t,i,r=e.originalEvent.clipboardData.items;for(t=0;t<r.length;t++)"file"===r[t].kind&&(i=r[t].getAsFile())&&(this.controller.uploader.uploader.param("post_data",{post_title:wp.template("acf-dropzone-attachment-title")({fieldname:this.controller.field.get("name")}).trim(),post_type:"attachment"}),this.controller.uploader.uploader.uploader.addFile(i,i.name));return this}}),a=Backbone.View.extend({initialize:function(e){var t;return this.field=e.field,this.notice=!1,this.progress=!1,this.uploader=new wp.media.view.UploaderWindow({controller:this,uploader:{dropzone:this.el,container:this.el,params:{_acfuploader:this.field.get("key")}}}),t=this.$el.is('[data-uploader="wp"]')?this.el:this.field.$(".acf-gallery-attachments").get(0),console.log(t),this.pasteboard=new r({controller:this,el:this.$el.is('[data-uploader="wp"]')?this.el:this.field.$(".acf-gallery-attachments").get(0)}),this},render:function(){return e(this.uploader.render().el).appendTo(this.el),this.pasteboard.render(),this},ready:function(){var t=this;return this.$el.on("drop dragenter dragleave dragover",function(e){e.stopPropagation()}).on("drop",function(e){t.removeNotice()}),this.trigger("activate"),this.uploader.ready(),this.uploader.uploader.uploader.bind("FilesAdded",this.filesAdded,this),this.uploader.uploader.uploader.bind("BeforeUpload",this.fileBeforeUpload,this),this.uploader.uploader.uploader.bind("UploadProgress",this.fileUploadProgress,this),this.uploader.uploader.uploader.bind("FileUploaded",this.fileUploaded,this),this.uploader.uploader.uploader.bind("error",this.fileUploadError,this),this.pasteboard.render(),this},filesAdded:function(e,t){this.total=t.length,this.done=0},fileBeforeUpload:function(e,t){this.addProgress(),this.progress.setLabel(_.escape(t.name))},fileUploadProgress:function(e,t){this.addProgress(),this.progress.setProgress((100*this.done+t.percent)/this.total)},fileUploaded:function(t,e,i){var r;this.file=e;try{this.trigger("acf-dropzone-uploaded",e.attachment,this.done),this.done++,this.total===this.done&&this.removeProgress()}catch(e){try{r=JSON.parse(i.response),this.fileUploadError(t,{file:this.file,message:r.data.message})}catch(e){this.fileUploadError(t,{file:this.file,message:i.response})}}},fileUploadError:function(e,t){this.done++,this.total===this.done&&this.removeProgress(),this.trigger("acf-dropzone-error",t),this.addNotice({type:"error",bold:_.escape(t.file.name),message:t.message})},addProgress:function(){return this.progress||(this.progress=new t,this.progress.render().$el.appendTo(this.el)),this},removeProgress:function(e){return this.progress&&(this.progress.$el.remove(),this.progress=!1),this},addNotice:function(e){return this.notice=new i(e),this.notice.render(),this.notice.$el.prependTo(this.el),this},removeNotice:function(e){return this.notice&&(this.notice.remove(),this.notice=!1),this}});function n(i){var e,r,t;(i=i).$el.is(".dropzone")&&(r=i.parent(),(e=i.$('[data-uploader="wp"]').get(0))&&(i.$(".hide-if-value>p").contents().filter(function(){return 3==this.nodeType}).remove(),(t=new s).render(),t.$el.prependTo(i.$(".hide-if-value")),(o=new a({el:e,field:i})).render(),o.ready(),o.on("acf-dropzone-uploaded",function(e,t){r&&"repeater"===r.get("type")&&0<t?i.append(e,r):i.render(e)})))}function d(t){var e=t.$(".acf-gallery-attachments").get(0);(t=t).$el.is(".dropzone")&&((o=new a({el:e,field:t})).render(),o.ready(),o.on("acf-dropzone-uploaded",function(e){t.appendAttachment(e,"prepend"===t.get("insert")?0:void 0)}))}acf.addAction("ready_field/type=image",n),acf.addAction("ready_field/type=file",n),acf.addAction("ready_field/type=gallery",d),acf.addAction("append_field/type=image",n),acf.addAction("append_field/type=file",n),acf.addAction("append_field/type=gallery",d)}(jQuery,acf_dropzone);