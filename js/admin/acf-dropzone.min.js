!function(e,o){var s=wp.media.View.extend({tagName:"div",className:"acf-dropzone-info",template:wp.template("acf-dropzone-info")}),i=Backbone.View.extend({tagName:"div",className:"media-progress-bar-box",render:function(){return this.$progress=e("<div />").addClass("media-progress-bar"),this.$label=e("<div />").addClass("media-progress-label"),this.$bar=e("<div />"),this.$el.append(this.$label),this.$progress.append(this.$bar).appendTo(this.$el),this},setLabel:function(e){this.$label.text(e)},setProgress:function(e){return this.$bar.width(e+"%"),this}}),t=wp.media.View.extend({template:wp.template("acf-dropzone-notice"),className:"notice is-dismissible",events:{"click .notice-dismiss":"remove"},render:function(){wp.media.View.prototype.render.apply(this,arguments),this.$el.addClass(this.options.type)}}),d=Backbone.View.extend({initialize:function(){return this.notice=!1,this.progress=!1,this.uploader=new wp.media.view.UploaderWindow({controller:this,uploader:{dropzone:this.el,container:this.el}}),this},render:function(){return e(this.uploader.render().el).appendTo(this.el),this},ready:function(){return this.$el.on("drop dragenter dragleave dragover",function(e){e.stopPropagation()}),this.trigger("activate"),this.uploader.ready(),this.uploader.uploader.uploader.bind("FilesAdded",this.filesAdded,this),this.uploader.uploader.uploader.bind("BeforeUpload",this.fileBeforeUpload,this),this.uploader.uploader.uploader.bind("UploadProgress",this.fileUploadProgress,this),this.uploader.uploader.uploader.bind("FileUploaded",this.fileUploaded,this),this.uploader.uploader.uploader.bind("error",this.fileUploadError,this),this},filesAdded:function(e,i){this.total=i.length,this.done=0},fileBeforeUpload:function(e,i){this.notice&&this.notice.remove(),this.addProgress(),this.progress.setLabel(_.escape(i.name)),this.notice=!1},fileUploadProgress:function(e,i){this.addProgress(),this.progress.setProgress((100*this.done+i.percent)/this.total)},fileUploaded:function(e,i,t){this.file=i,this.trigger("acf-dropzone-uploaded",i.attachment,this.done),this.done++,this.total===this.done&&this.removeProgress()},fileUploadError:function(e,i){this.done++,this.removeProgress(),this.trigger("acf-dropzone-error",i),this.notice=new t({type:"error",bold:_.escape(i.file.name),message:i.message}),this.notice.render(),this.notice.$el.prependTo(this.el),this.total--},addProgress:function(){if(this.progress)return this;this.progress=new i,this.progress.render().$el.appendTo(this.el)},removeProgress:function(e){return this.progress&&(this.progress.$el.remove(),this.progress=!1),this}});function r(t){var e,r,i;(t=t).$el.is(".dropzone")&&(r=t.parent(),(e=t.$('[data-uploader="wp"]').get(0))&&(t.$(".hide-if-value>p").contents().filter(function(){return 3==this.nodeType}).remove(),(i=new s).render(),i.$el.prependTo(t.$(".hide-if-value")),(o=new d({el:e})).render(),o.ready(),o.on("acf-dropzone-uploaded",function(e,i){"repeater"===r.get("type")&&0<i?t.append(e,r):t.render(e)})))}function a(i){var e=i.$(".acf-gallery-main").get(0);(i=i).$el.is(".dropzone")&&((o=new d({el:e})).render(),o.ready(),o.on("acf-dropzone-uploaded",function(e){i.appendAttachment(e,"prepend"===i.get("insert")?0:void 0)}))}acf.addAction("ready_field/type=image",r),acf.addAction("ready_field/type=file",r),acf.addAction("ready_field/type=gallery",a),acf.addAction("append_field/type=image",r),acf.addAction("append_field/type=file",r),acf.addAction("append_field/type=gallery",a)}(jQuery,acf_dropzone);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1kcm9wem9uZS5qcyJdLCJuYW1lcyI6WyIkIiwiZHJvcHpvbmUiLCJVcGxvYWRlckluZm8iLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRhZ05hbWUiLCJjbGFzc05hbWUiLCJ0ZW1wbGF0ZSIsIlByb2dyZXNzIiwiQmFja2JvbmUiLCJyZW5kZXIiLCJ0aGlzIiwiJHByb2dyZXNzIiwiYWRkQ2xhc3MiLCIkbGFiZWwiLCIkYmFyIiwiJGVsIiwiYXBwZW5kIiwiYXBwZW5kVG8iLCJzZXRMYWJlbCIsImxhYmVsIiwidGV4dCIsInNldFByb2dyZXNzIiwicGVyY2VudCIsIndpZHRoIiwiTm90aWNlIiwiZXZlbnRzIiwiY2xpY2sgLm5vdGljZS1kaXNtaXNzIiwicHJvdG90eXBlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJvcHRpb25zIiwidHlwZSIsIkFDRkRyb3B6b25lIiwiaW5pdGlhbGl6ZSIsIm5vdGljZSIsInByb2dyZXNzIiwidXBsb2FkZXIiLCJ2aWV3IiwiVXBsb2FkZXJXaW5kb3ciLCJjb250cm9sbGVyIiwiZWwiLCJjb250YWluZXIiLCJyZWFkeSIsIm9uIiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsInRyaWdnZXIiLCJiaW5kIiwiZmlsZXNBZGRlZCIsImZpbGVCZWZvcmVVcGxvYWQiLCJmaWxlVXBsb2FkUHJvZ3Jlc3MiLCJmaWxlVXBsb2FkZWQiLCJmaWxlVXBsb2FkRXJyb3IiLCJmaWxlcyIsInRvdGFsIiwibGVuZ3RoIiwiZG9uZSIsImZpbGUiLCJyZW1vdmUiLCJhZGRQcm9ncmVzcyIsIl8iLCJlc2NhcGUiLCJuYW1lIiwicmVzcG9uc2UiLCJhdHRhY2htZW50IiwicmVtb3ZlUHJvZ3Jlc3MiLCJlcnJvciIsImJvbGQiLCJtZXNzYWdlIiwicHJlcGVuZFRvIiwiaW5pdEZpbGVEcm9wem9uZSIsImZpZWxkIiwicGFyZW50IiwiaW5mbyIsImlzIiwiZ2V0IiwiY29udGVudHMiLCJmaWx0ZXIiLCJub2RlVHlwZSIsImkiLCJpbml0R2FsbGVyeURyb3B6b25lIiwiYXBwZW5kQXR0YWNobWVudCIsInVuZGVmaW5lZCIsImFjZiIsImFkZEFjdGlvbiIsImpRdWVyeSIsImFjZl9kcm9wem9uZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0EsRUFBR0MsR0F3QmIsSUFBSUMsRUFBZUMsR0FBR0MsTUFBTUMsS0FBS0MsT0FBTyxDQUN2Q0MsUUFBVyxNQUNYQyxVQUFXLG9CQUNYQyxTQUFTTixHQUFHTSxTQUFTLHVCQUVsQkMsRUFBV0MsU0FBU04sS0FBS0MsT0FBTyxDQUNuQ0MsUUFBVyxNQUNYQyxVQUFXLHlCQUNYSSxPQUFPLFdBVU4sT0FUQUMsS0FBS0MsVUFBWWQsRUFBRSxXQUFXZSxTQUFTLHNCQUN2Q0YsS0FBS0csT0FBU2hCLEVBQUUsV0FBV2UsU0FBUyx3QkFDcENGLEtBQUtJLEtBQU9qQixFQUFFLFdBQ2RhLEtBQUtLLElBQ0hDLE9BQVFOLEtBQUtHLFFBQ2ZILEtBQUtDLFVBQ0hLLE9BQVFOLEtBQUtJLE1BQ2JHLFNBQVVQLEtBQUtLLEtBRVZMLE1BRVJRLFNBQVMsU0FBU0MsR0FDakJULEtBQUtHLE9BQU9PLEtBQUtELElBRWxCRSxZQUFZLFNBQVVDLEdBRXJCLE9BREFaLEtBQUtJLEtBQUtTLE1BQU8sRUFBWSxLQUN0QmIsUUFHTGMsRUFBU3hCLEdBQUdDLE1BQU1DLEtBQUtDLE9BQU8sQ0FDakNHLFNBQVNOLEdBQUdNLFNBQVMsdUJBQ3JCRCxVQUFVLHdCQUNWb0IsT0FBTyxDQUNOQyx3QkFBMEIsVUFFM0JqQixPQUFPLFdBQ05ULEdBQUdDLE1BQU1DLEtBQUt5QixVQUFVbEIsT0FBT21CLE1BQU1sQixLQUFLbUIsV0FFMUNuQixLQUFLSyxJQUFJSCxTQUFTRixLQUFLb0IsUUFBUUMsU0FLN0JDLEVBQWN4QixTQUFTTixLQUFLQyxPQUFPLENBQ3RDOEIsV0FBWSxXQVdYLE9BVkF2QixLQUFLd0IsUUFBUyxFQUNkeEIsS0FBS3lCLFVBQVcsRUFDaEJ6QixLQUFLMEIsU0FBVyxJQUFJcEMsR0FBR0MsTUFBTW9DLEtBQUtDLGVB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QUFJa0MsRUFBWSxDQUMxQlEsR0FBSUEsS0FFSS9CLFNBQ1RYLEVBQVM0QyxRQUNUNUMsRUFBUzZDLEdBQUcsd0JBQXlCLFNBQVVxQixFQUFZZSxHQUM5QixhQUF2QlAsRUFBT0csSUFBSSxTQUE4QixFQUFKSSxFQUN6Q1IsRUFBTXZELE9BQVFnRCxFQUFZUSxHQUUxQkQsRUFBTTlELE9BQU91RCxPQUtoQixTQUFTZ0IsRUFBcUJULEdBQzdCLElBQUkvQixFQUFLK0IsRUFBTTFFLEVBQUUscUJBQXFCOEUsSUFBSSxJQUN6Q0osRUFBUUEsR0FFSXhELElBQUkyRCxHQUFHLGdCQUlwQjVFLEVBQVcsSUFBSWtDLEVBQVksQ0FDMUJRLEdBQUlBLEtBRUkvQixTQUNUWCxFQUFTNEMsUUFDVDVDLEVBQVM2QyxHQUFHLHdCQUF5QixTQUFVcUIsR0FFOUNPLEVBQU1VLGlCQUNMakIsRUFDd0IsWUFBeEJPLEVBQU1JLElBQUksVUFBMEIsT0FBSU8sTUFPM0NDLElBQUlDLFVBQVcseUJBQTRCZCxHQUMzQ2EsSUFBSUMsVUFBVyx3QkFBNEJkLEdBQzNDYSxJQUFJQyxVQUFXLDJCQUE0QkosR0FHM0NHLElBQUlDLFVBQVcsMEJBQTZCZCxHQUM1Q2EsSUFBSUMsVUFBVyx5QkFBNkJkLEdBQzVDYSxJQUFJQyxVQUFXLDRCQUE2QkosR0FoUDdDLENBbVBHSyxPQUFRQyIsImZpbGUiOiJhY2YtZHJvcHpvbmUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBkcm9wem9uZSApe1xuXHQvL1xuXHQvLyBkcm9wem9uZS5Ecm9wbG9hZGVyID0gd3AuVXBsb2FkZXIuZXh0ZW5kKHtcblx0Ly8gXHRpbml0OiAgICAgZnVuY3Rpb24oZSkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZSk7XG5cdC8vIFx0fSxcblx0Ly8gXHRlcnJvcjogICAgZnVuY3Rpb24oZSkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZSk7XG5cdC8vIFx0fSxcblx0Ly8gXHRzdWNjZXNzOiAgZnVuY3Rpb24oZSkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZSk7XG5cdC8vIFx0fSxcblx0Ly8gXHRhZGRlZDogICAgZnVuY3Rpb24oZSkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZSk7XG5cdC8vIFx0fSxcblx0Ly8gXHRwcm9ncmVzczogZnVuY3Rpb24oZSkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZSk7XG5cdC8vIFx0fSxcblx0Ly8gXHRjb21wbGV0ZTogZnVuY3Rpb24oZSkge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZSk7XG5cdC8vIFx0fSxcblx0Ly9cblx0Ly8gfSk7XG5cblx0dmFyIFVwbG9hZGVySW5mbyA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHR0YWdOYW1lOiAgICdkaXYnLFxuXHRcdGNsYXNzTmFtZTogJ2FjZi1kcm9wem9uZS1pbmZvJyxcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNmLWRyb3B6b25lLWluZm8nKVxuXHR9KTtcblx0dmFyIFByb2dyZXNzID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdHRhZ05hbWU6ICAgJ2RpdicsXG5cdFx0Y2xhc3NOYW1lOiAnbWVkaWEtcHJvZ3Jlc3MtYmFyLWJveCcsXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy4kcHJvZ3Jlc3MgPSAkKCc8ZGl2IC8+JykuYWRkQ2xhc3MoJ21lZGlhLXByb2dyZXNzLWJhcicpO1xuXHRcdFx0dGhpcy4kbGFiZWwgPSAkKCc8ZGl2IC8+JykuYWRkQ2xhc3MoJ21lZGlhLXByb2dyZXNzLWxhYmVsJyk7XG5cdFx0XHR0aGlzLiRiYXIgPSAkKCc8ZGl2IC8+Jyk7XG5cdFx0XHR0aGlzLiRlbFxuXHRcdFx0XHQuYXBwZW5kKCB0aGlzLiRsYWJlbCApO1xuXHRcdFx0dGhpcy4kcHJvZ3Jlc3Ncblx0XHRcdFx0LmFwcGVuZCggdGhpcy4kYmFyIClcblx0XHRcdFx0LmFwcGVuZFRvKCB0aGlzLiRlbCApO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHNldExhYmVsOmZ1bmN0aW9uKGxhYmVsKSB7XG5cdFx0XHR0aGlzLiRsYWJlbC50ZXh0KGxhYmVsKTtcblx0XHR9LFxuXHRcdHNldFByb2dyZXNzOmZ1bmN0aW9uKCBwZXJjZW50ICkge1xuXHRcdFx0dGhpcy4kYmFyLndpZHRoKCAoIHBlcmNlbnQgKSsnJScpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblx0dmFyIE5vdGljZSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTp3cC50ZW1wbGF0ZSgnYWNmLWRyb3B6b25lLW5vdGljZScpLFxuXHRcdGNsYXNzTmFtZTonbm90aWNlIGlzLWRpc21pc3NpYmxlJyxcblx0XHRldmVudHM6e1xuXHRcdFx0J2NsaWNrIC5ub3RpY2UtZGlzbWlzcycgOiAncmVtb3ZlJyxcblx0XHR9LFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpIHtcblx0XHRcdHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cblx0XHRcdHRoaXMuJGVsLmFkZENsYXNzKHRoaXMub3B0aW9ucy50eXBlKTtcblx0XHR9XG5cdH0pXG5cblxuXHR2YXIgQUNGRHJvcHpvbmUgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLm5vdGljZSA9IGZhbHNlO1xuXHRcdFx0dGhpcy5wcm9ncmVzcyA9IGZhbHNlO1xuXHRcdFx0dGhpcy51cGxvYWRlciA9IG5ldyB3cC5tZWRpYS52aWV3LlVwbG9hZGVyV2luZG93KHtcblx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0dXBsb2FkZXI6IHtcblx0XHRcdFx0XHRkcm9wem9uZTogIHRoaXMuZWwsXG5cdFx0XHRcdFx0Y29udGFpbmVyOiB0aGlzLmVsLFxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHQkKCB0aGlzLnVwbG9hZGVyLnJlbmRlcigpLmVsICkuYXBwZW5kVG8oIHRoaXMuZWwgKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZWFkeTogZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBwcmV2ZW50IGJsb2NrIGVkaXRvciBmaWxlIGRyb3Bcblx0XHRcdHRoaXMuJGVsLm9uKCdkcm9wIGRyYWdlbnRlciBkcmFnbGVhdmUgZHJhZ292ZXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpXG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy50cmlnZ2VyKCdhY3RpdmF0ZScpXG5cdFx0XHR0aGlzLnVwbG9hZGVyLnJlYWR5KCk7XG5cdFx0XHQvL1xuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5iaW5kKCdGaWxlc0FkZGVkJywgdGhpcy5maWxlc0FkZGVkLCB0aGlzICk7XG5cdFx0XHR0aGlzLnVwbG9hZGVyLnVwbG9hZGVyLnVwbG9hZGVyLmJpbmQoJ0JlZm9yZVVwbG9hZCcsIHRoaXMuZmlsZUJlZm9yZVVwbG9hZCwgdGhpcyApO1xuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5iaW5kKCdVcGxvYWRQcm9ncmVzcycsIHRoaXMuZmlsZVVwbG9hZFByb2dyZXNzLCB0aGlzICk7XG5cdFx0XHR0aGlzLnVwbG9hZGVyLnVwbG9hZGVyLnVwbG9hZGVyLmJpbmQoJ0ZpbGVVcGxvYWRlZCcsIHRoaXMuZmlsZVVwbG9hZGVkLCB0aGlzICk7XG5cdFx0XHR0aGlzLnVwbG9hZGVyLnVwbG9hZGVyLnVwbG9hZGVyLmJpbmQoJ2Vycm9yJywgdGhpcy5maWxlVXBsb2FkRXJyb3IsIHRoaXMgKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRmaWxlc0FkZGVkOiBmdW5jdGlvbiggdXBsb2FkZXIsIGZpbGVzICkge1xuXHRcdFx0dGhpcy50b3RhbCA9IGZpbGVzLmxlbmd0aDtcblx0XHRcdHRoaXMuZG9uZSA9IDA7XG5cdFx0fSxcblx0XHRmaWxlQmVmb3JlVXBsb2FkOiBmdW5jdGlvbiggdXBsb2FkZXIsIGZpbGUgKSB7XG5cdFx0XHQhISB0aGlzLm5vdGljZSAmJiB0aGlzLm5vdGljZS5yZW1vdmUoKTtcblx0XHRcdHRoaXMuYWRkUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMucHJvZ3Jlc3Muc2V0TGFiZWwoIF8uZXNjYXBlKGZpbGUubmFtZSkgKTtcblx0XHRcdHRoaXMubm90aWNlID0gZmFsc2U7XG5cdFx0fSxcblx0XHRmaWxlVXBsb2FkUHJvZ3Jlc3M6ZnVuY3Rpb24oIHVwbG9hZGVyLCBmaWxlICkge1xuXHRcdFx0dGhpcy5hZGRQcm9ncmVzcygpO1xuXHRcdFx0dGhpcy5wcm9ncmVzcy5zZXRQcm9ncmVzcyggKCAxMDAgKiB0aGlzLmRvbmUgKyBmaWxlLnBlcmNlbnQgKSAvIHRoaXMudG90YWwgKTtcblx0XHR9LFxuXHRcdGZpbGVVcGxvYWRlZDpmdW5jdGlvbiggdXBsb2FkZXIsIGZpbGUsIHJlc3BvbnNlICkge1xuXHRcdFx0dGhpcy5maWxlID0gZmlsZTtcblx0XHRcdHRoaXMudHJpZ2dlcignYWNmLWRyb3B6b25lLXVwbG9hZGVkJyxmaWxlLmF0dGFjaG1lbnQsdGhpcy5kb25lKTtcblx0XHRcdHRoaXMuZG9uZSsrO1xuXHRcdFx0aWYgKHRoaXMudG90YWwgPT09IHRoaXMuZG9uZSApIHtcblx0XHRcdFx0dGhpcy5yZW1vdmVQcm9ncmVzcygpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0ZmlsZVVwbG9hZEVycm9yOmZ1bmN0aW9uKCB1cGxvYWRlciwgZXJyb3IgKSB7XG5cdFx0XHR0aGlzLmRvbmUrKztcblx0XHRcdHRoaXMucmVtb3ZlUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMudHJpZ2dlciggJ2FjZi1kcm9wem9uZS1lcnJvcicsIGVycm9yICk7XG5cblx0XHRcdHRoaXMubm90aWNlID0gbmV3IE5vdGljZSh7XG5cdFx0XHRcdHR5cGU6J2Vycm9yJyxcblx0XHRcdFx0Ym9sZDogXy5lc2NhcGUoZXJyb3IuZmlsZS5uYW1lKSxcblx0XHRcdFx0bWVzc2FnZTogZXJyb3IubWVzc2FnZVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLm5vdGljZS5yZW5kZXIoKTtcblx0XHRcdHRoaXMubm90aWNlLiRlbC5wcmVwZW5kVG8odGhpcy5lbCk7XG5cdFx0XHR0aGlzLnRvdGFsLS07XG5cdFx0fSxcblxuXHRcdGFkZFByb2dyZXNzOmZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCB0aGlzLnByb2dyZXNzICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMucHJvZ3Jlc3MgPSBuZXcgUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMucHJvZ3Jlc3MucmVuZGVyKCkuJGVsLmFwcGVuZFRvKHRoaXMuZWwpO1xuXHRcdH0sXG5cdFx0cmVtb3ZlUHJvZ3Jlc3M6ZnVuY3Rpb24oIHBlcmNlbnQgKSB7XG5cdFx0XHRpZiAoICEgdGhpcy5wcm9ncmVzcyApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMucHJvZ3Jlc3MuJGVsLnJlbW92ZSgpO1xuXHRcdFx0dGhpcy5wcm9ncmVzcyA9IGZhbHNlO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0fSk7XG4vKlxuPGRpdiBpZD1cIm1lc3NhZ2VcIiBjbGFzcz1cIm5vdGljZSBpcy1kaXNtaXNzaWJsZVwiPlxuXHQ8cD5tc2c8L3A+XG5cdDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwibm90aWNlLWRpc21pc3NcIj5cblx0XHQ8c3BhbiBjbGFzcz1cInNjcmVlbi1yZWFkZXItdGV4dFwiPkRpc21pc3MgdGhpcyBub3RpY2UuPC9zcGFuPlxuXHQ8L2J1dHRvbj5cbjwvZGl2PlxuKi9cblxuXG5cdGZ1bmN0aW9uIGluaXRGaWxlRHJvcHpvbmUoIGZpZWxkICkge1xuXHRcdHZhciBlbCxcblx0XHRcdGZpZWxkID0gZmllbGQsXG5cdFx0XHRwYXJlbnQsXG5cdFx0XHRpbmZvO1xuXG5cdFx0aWYgKCAhIGZpZWxkLiRlbC5pcygnLmRyb3B6b25lJykgKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0cGFyZW50ID0gZmllbGQucGFyZW50KCk7XG5cblx0XHRlbCA9IGZpZWxkLiQoJ1tkYXRhLXVwbG9hZGVyPVwid3BcIl0nKS5nZXQoMClcblxuXHRcdGlmICggISBlbCApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0Ly8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTU3MTA3Ni9yZW1vdmUtdGV4dC13aXRoLWpxdWVyeVxuXHRcdGZpZWxkLiQoJy5oaWRlLWlmLXZhbHVlPnAnKVxuXHRcdFx0LmNvbnRlbnRzKClcblx0XHRcdC5maWx0ZXIoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5ub2RlVHlwZSA9PSAzOyAvL05vZGUuVEVYVF9OT0RFXG5cdFx0XHR9KVxuXHRcdFx0LnJlbW92ZSgpO1xuXG5cdFx0aW5mbyA9IG5ldyBVcGxvYWRlckluZm8oKTtcblx0XHRpbmZvLnJlbmRlcigpO1xuXHRcdGluZm8uJGVsLnByZXBlbmRUbyggZmllbGQuJCgnLmhpZGUtaWYtdmFsdWUnKSApO1xuXG5cdFx0ZHJvcHpvbmUgPSBuZXcgQUNGRHJvcHpvbmUoe1xuXHRcdFx0ZWw6IGVsLFxuXHRcdH0pO1xuXHRcdGRyb3B6b25lLnJlbmRlcigpO1xuXHRcdGRyb3B6b25lLnJlYWR5KCk7XG5cdFx0ZHJvcHpvbmUub24oJ2FjZi1kcm9wem9uZS11cGxvYWRlZCcsIGZ1bmN0aW9uKCBhdHRhY2htZW50LCBpICl7XG5cdFx0XHRpZiAoIHBhcmVudC5nZXQoJ3R5cGUnKSA9PT0gJ3JlcGVhdGVyJyAmJiBpID4gMCApIHtcblx0XHRcdFx0ZmllbGQuYXBwZW5kKCBhdHRhY2htZW50LCBwYXJlbnQgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZpZWxkLnJlbmRlcihhdHRhY2htZW50KTtcdFx0XHRcdFxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gaW5pdEdhbGxlcnlEcm9wem9uZSggZmllbGQgKSB7XG5cdFx0dmFyIGVsID0gZmllbGQuJCgnLmFjZi1nYWxsZXJ5LW1haW4nKS5nZXQoMCksXG5cdFx0XHRmaWVsZCA9IGZpZWxkO1xuXG5cdFx0aWYgKCAhIGZpZWxkLiRlbC5pcygnLmRyb3B6b25lJykgKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0ZHJvcHpvbmUgPSBuZXcgQUNGRHJvcHpvbmUoe1xuXHRcdFx0ZWw6IGVsLFxuXHRcdH0pO1xuXHRcdGRyb3B6b25lLnJlbmRlcigpO1xuXHRcdGRyb3B6b25lLnJlYWR5KCk7XG5cdFx0ZHJvcHpvbmUub24oJ2FjZi1kcm9wem9uZS11cGxvYWRlZCcsIGZ1bmN0aW9uKCBhdHRhY2htZW50ICl7XG5cblx0XHRcdGZpZWxkLmFwcGVuZEF0dGFjaG1lbnQoXG5cdFx0XHRcdGF0dGFjaG1lbnQsXG5cdFx0XHRcdGZpZWxkLmdldCgnaW5zZXJ0JykgPT09ICdwcmVwZW5kJyA/IDAgOiB1bmRlZmluZWRcblx0XHRcdCk7XG5cblx0XHR9KTtcblx0fVxuXG5cblx0YWNmLmFkZEFjdGlvbiggJ3JlYWR5X2ZpZWxkL3R5cGU9aW1hZ2UnLCAgIGluaXRGaWxlRHJvcHpvbmUgKTtcblx0YWNmLmFkZEFjdGlvbiggJ3JlYWR5X2ZpZWxkL3R5cGU9ZmlsZScsICAgIGluaXRGaWxlRHJvcHpvbmUgKTtcblx0YWNmLmFkZEFjdGlvbiggJ3JlYWR5X2ZpZWxkL3R5cGU9Z2FsbGVyeScsIGluaXRHYWxsZXJ5RHJvcHpvbmUgKTtcblxuXHQvLyBjcmVhdGVkIGZyb20gcmVwZWF0ZXJcblx0YWNmLmFkZEFjdGlvbiggJ2FwcGVuZF9maWVsZC90eXBlPWltYWdlJywgICBpbml0RmlsZURyb3B6b25lICk7XG5cdGFjZi5hZGRBY3Rpb24oICdhcHBlbmRfZmllbGQvdHlwZT1maWxlJywgICAgaW5pdEZpbGVEcm9wem9uZSApO1xuXHRhY2YuYWRkQWN0aW9uKCAnYXBwZW5kX2ZpZWxkL3R5cGU9Z2FsbGVyeScsIGluaXRHYWxsZXJ5RHJvcHpvbmUgKTtcblxuXG59KShqUXVlcnksIGFjZl9kcm9wem9uZSApO1xuIl19
