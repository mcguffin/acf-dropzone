!function(e,r){var o=wp.media.View.extend({tagName:"div",className:"acf-dropzone-info",template:wp.template("acf-dropzone-info")}),i=Backbone.View.extend({tagName:"div",className:"media-progress-bar-box",render:function(){return this.$progress=e("<div />").addClass("media-progress-bar"),this.$label=e("<div />").addClass("media-progress-label"),this.$bar=e("<div />"),this.$el.append(this.$label),this.$progress.append(this.$bar).appendTo(this.$el),this},setLabel:function(e){this.$label.text(e)},setProgress:function(e){return this.$bar.width(e+"%"),this}}),t=wp.media.View.extend({template:wp.template("acf-dropzone-notice"),className:"notice is-dismissible",events:{"click .notice-dismiss":"remove"},render:function(){wp.media.View.prototype.render.apply(this,arguments),this.$el.addClass(this.options.type)}}),s=Backbone.View.extend({initialize:function(){return this.notice=!1,this.progress=!1,this.uploader=new wp.media.view.UploaderWindow({controller:this,uploader:{dropzone:this.el,container:this.el}}),this},render:function(){return e(this.uploader.render().el).appendTo(this.el),this},ready:function(){return this.$el.on("drop dragenter dragleave dragover",function(e){e.stopPropagation()}),this.trigger("activate"),this.uploader.ready(),this.uploader.uploader.uploader.bind("FilesAdded",this.filesAdded,this),this.uploader.uploader.uploader.bind("BeforeUpload",this.fileBeforeUpload,this),this.uploader.uploader.uploader.bind("UploadProgress",this.fileUploadProgress,this),this.uploader.uploader.uploader.bind("FileUploaded",this.fileUploaded,this),this.uploader.uploader.uploader.bind("error",this.fileUploadError,this),this},filesAdded:function(e,i){this.total=i.length,this.done=0},fileBeforeUpload:function(e,i){this.notice&&this.notice.remove(),this.addProgress(),this.progress.setLabel(_.escape(i.name)),this.notice=!1},fileUploadProgress:function(e,i){this.addProgress(),this.progress.setProgress((100*this.done+i.percent)/this.total)},fileUploaded:function(e,i,t){this.done++,this.file=i,this.removeProgress(),this.trigger("acf-dropzone-uploaded",i.attachment)},fileUploadError:function(e,i){this.done++,this.removeProgress(),this.trigger("acf-dropzone-error",i),this.notice=new t({type:"error",bold:_.escape(i.file.name),message:i.message}),this.notice.render(),this.notice.$el.prependTo(this.el),this.total--},addProgress:function(){if(this.progress)return this;this.progress=new i,this.progress.render().$el.appendTo(this.el)},removeProgress:function(e){return this.progress&&(this.progress.$el.remove(),this.progress=!1),this}});function d(i){var e,t;(i=i).$el.is(".dropzone")&&(e=i.$('[data-uploader="wp"]').get(0))&&(i.$(".hide-if-value>p").contents().filter(function(){return 3==this.nodeType}).remove(),(t=new o).render(),t.$el.prependTo(i.$(".hide-if-value")),(r=new s({el:e})).render(),r.ready(),r.on("acf-dropzone-uploaded",function(e){i.render(e)}))}function a(i){var e=i.$(".acf-gallery-main").get(0);(i=i).$el.is(".dropzone")&&((r=new s({el:e})).render(),r.ready(),r.on("acf-dropzone-uploaded",function(e){i.appendAttachment(e,"prepend"===i.get("insert")?0:void 0)}))}acf.addAction("ready_field/type=image",d),acf.addAction("ready_field/type=file",d),acf.addAction("ready_field/type=gallery",a),acf.addAction("append_field/type=image",d),acf.addAction("append_field/type=file",d),acf.addAction("append_field/type=gallery",a)}(jQuery,acf_dropzone);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1kcm9wem9uZS5qcyJdLCJuYW1lcyI6WyIkIiwiZHJvcHpvbmUiLCJVcGxvYWRlckluZm8iLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRhZ05hbWUiLCJjbGFzc05hbWUiLCJ0ZW1wbGF0ZSIsIlByb2dyZXNzIiwiQmFja2JvbmUiLCJyZW5kZXIiLCJ0aGlzIiwiJHByb2dyZXNzIiwiYWRkQ2xhc3MiLCIkbGFiZWwiLCIkYmFyIiwiJGVsIiwiYXBwZW5kIiwiYXBwZW5kVG8iLCJzZXRMYWJlbCIsImxhYmVsIiwidGV4dCIsInNldFByb2dyZXNzIiwicGVyY2VudCIsIndpZHRoIiwiTm90aWNlIiwiZXZlbnRzIiwiY2xpY2sgLm5vdGljZS1kaXNtaXNzIiwicHJvdG90eXBlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJvcHRpb25zIiwidHlwZSIsIkFDRkRyb3B6b25lIiwiaW5pdGlhbGl6ZSIsIm5vdGljZSIsInByb2dyZXNzIiwidXBsb2FkZXIiLCJ2aWV3IiwiVXBsb2FkZXJXaW5kb3ciLCJjb250cm9sbGVyIiwiZWwiLCJjb250YWluZXIiLCJyZWFkeSIsIm9uIiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsInRyaWdnZXIiLCJiaW5kIiwiZmlsZXNBZGRlZCIsImZpbGVCZWZvcmVVcGxvYWQiLCJmaWxlVXBsb2FkUHJvZ3Jlc3MiLCJmaWxlVXBsb2FkZWQiLCJmaWxlVXBsb2FkRXJyb3IiLCJmaWxlcyIsInRvdGFsIiwibGVuZ3RoIiwiZG9uZSIsImZpbGUiLCJyZW1vdmUiLCJhZGRQcm9ncmVzcyIsIl8iLCJlc2NhcGUiLCJuYW1lIiwicmVzcG9uc2UiLCJyZW1vdmVQcm9ncmVzcyIsImF0dGFjaG1lbnQiLCJlcnJvciIsImJvbGQiLCJtZXNzYWdlIiwicHJlcGVuZFRvIiwiaW5pdEZpbGVEcm9wem9uZSIsImZpZWxkIiwiaW5mbyIsImlzIiwiZ2V0IiwiY29udGVudHMiLCJmaWx0ZXIiLCJub2RlVHlwZSIsImluaXRHYWxsZXJ5RHJvcHpvbmUiLCJhcHBlbmRBdHRhY2htZW50IiwidW5kZWZpbmVkIiwiYWNmIiwiYWRkQWN0aW9uIiwialF1ZXJ5IiwiYWNmX2Ryb3B6b25lIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFXQSxFQUFHQyxHQXdCYixJQUFJQyxFQUFlQyxHQUFHQyxNQUFNQyxLQUFLQyxPQUFPLENBQ3ZDQyxRQUFXLE1BQ1hDLFVBQVcsb0JBQ1hDLFNBQVNOLEdBQUdNLFNBQVMsdUJBRWxCQyxFQUFXQyxTQUFTTixLQUFLQyxPQUFPLENBQ25DQyxRQUFXLE1BQ1hDLFVBQVcseUJBQ1hJLE9BQU8sV0FVTixPQVRBQyxLQUFLQyxVQUFZZCxFQUFFLFdBQVdlLFNBQVMsc0JBQ3ZDRixLQUFLRyxPQUFTaEIsRUFBRSxXQUFXZSxTQUFTLHdCQUNwQ0YsS0FBS0ksS0FBT2pCLEVBQUUsV0FDZGEsS0FBS0ssSUFDSEMsT0FBUU4sS0FBS0csUUFDZkgsS0FBS0MsVUFDSEssT0FBUU4sS0FBS0ksTUFDYkcsU0FBVVAsS0FBS0ssS0FFVkwsTUFFUlEsU0FBUyxTQUFTQyxHQUNqQlQsS0FBS0csT0FBT08sS0FBS0QsSUFFbEJFLFlBQVksU0FBVUMsR0FFckIsT0FEQVosS0FBS0ksS0FBS1MsTUFBTyxFQUFZLEtBQ3RCYixRQUdMYyxFQUFTeEIsR0FBR0MsTUFBTUMsS0FBS0MsT0FBTyxDQUNqQ0csU0FBU04sR0FBR00sU0FBUyx1QkFDckJELFVBQVUsd0JBQ1ZvQixPQUFPLENBQ05DLHdCQUEwQixVQUUzQmpCLE9BQU8sV0FDTlQsR0FBR0MsTUFBTUMsS0FBS3lCLFVBQVVsQixPQUFPbUIsTUFBTWxCLEtBQUttQixXQUUxQ25CLEtBQUtLLElBQUlILFNBQVNGLEtBQUtvQixRQUFRQyxTQUs3QkMsRUFBY3hCLFNBQVNOLEtBQUtDLE9BQU8sQ0FDdEM4QixXQUFZLFdBV1gsT0FWQXZCLEtBQUt3QixRQUFTLEVBQ2R4QixLQUFLeUIsVUFBVyxFQUNoQnpCLEtBQUswQixTQUFXLElBQUlwQyxHQUFHQyxNQUFNb0MsS0FBS0MsZUFBZSxDQUNoREMsV0FBWTdCLEtBQ1owQixTQUFVLENBQ1R0QyxTQUFXWSxLQUFLOEIsR0FDaEJDLFVBQVcvQixLQUFLOEIsTUFJWDlCLE1BRVJELE9BQU8sV0FHTixPQUZBWixFQUFHYSxLQUFLMEIsU0FBUzNCLFNBQVMrQixJQUFLdkIsU0FBVVAsS0FBSzhCLElBRXZDOUIsTUFFUmdDLE1BQU8sV0FlTixPQWJBaEMsS0FBS0ssSUFBSTRCLEdBQUcsb0NBQW9DLFNBQVNDLEdBQ3hEQSxFQUFFQyxvQkFHSG5DLEtBQUtvQyxRQUFRLFlBQ2JwQyxLQUFLMEIsU0FBU00sUUFFZGhDLEtBQUswQixTQUFTQSxTQUFTQSxTQUFTVyxLQUFLLGFBQWNyQyxLQUFLc0MsV0FBWXRDLE1BQ3BFQSxLQUFLMEIsU0FBU0EsU0FBU0EsU0FBU1csS0FBSyxlQUFnQnJDLEtBQUt1QyxpQkFBa0J2QyxNQUM1RUEsS0FBSzBCLFNBQVNBLFNBQVNBLFNBQVNXLEtBQUssaUJBQWtCckMsS0FBS3dDLG1CQUFvQnhDLE1BQ2hGQSxLQUFLMEIsU0FBU0EsU0FBU0EsU0FBU1csS0FBSyxlQUFnQnJDLEtBQUt5QyxhQUFjekMsTUFDeEVBLEtBQUswQixTQUFTQSxTQUFTQSxTQUFTVyxLQUFLLFFBQVNyQyxLQUFLMEMsZ0JBQWlCMUMsTUFFN0RBLE1BRVJzQyxXQUFZLFNBQVVaLEVBQVVpQixHQUMvQjNDLEtBQUs0QyxNQUFRRCxFQUFNRSxPQUNuQjdDLEtBQUs4QyxLQUFPLEdBRWJQLGlCQUFrQixTQUFVYixFQUFVcUIsR0FDbEMvQyxLQUFLd0IsUUFBVXhCLEtBQUt3QixPQUFPd0IsU0FDOUJoRCxLQUFLaUQsY0FDTGpELEtBQUt5QixTQUFTakIsU0FBVTBDLEVBQUVDLE9BQU9KLEVBQUtLLE9BQ3RDcEQsS0FBS3dCLFFBQVMsR0FFZmdCLG1CQUFtQixTQUFVZCxFQUFVcUIsR0FDdEMvQyxLQUFLaUQsY0FDTGpELEtBQUt5QixTQUFTZCxhQUFlLElBQU1YLEtBQUs4QyxLQUFPQyxFQUFLbkMsU0FBWVosS0FBSzRDLFFBRXRFSCxhQUFhLFNBQVVmLEVBQVVxQixFQUFNTSxHQUN0Q3JELEtBQUs4QyxPQUNMOUMsS0FBSytDLEtBQU9BLEVBQ1ovQyxLQUFLc0QsaUJBQ0x0RCxLQUFLb0MsUUFBUSx3QkFBd0JXLEVBQUtRLGFBRTNDYixnQkFBZ0IsU0FBVWhCLEVBQVU4QixHQUNuQ3hELEtBQUs4QyxPQUNMOUMsS0FBS3NELGlCQUNMdEQsS0FBS29DLFFBQVMscUJBQXNCb0IsR0FFcEN4RCxLQUFLd0IsT0FBUyxJQUFJVixFQUFPLENBQ3hCTyxLQUFLLFFBQ0xvQyxLQUFNUCxFQUFFQyxPQUFPSyxFQUFNVCxLQUFLSyxNQUMxQk0sUUFBU0YsRUFBTUUsVUFFaEIxRCxLQUFLd0IsT0FBT3pCLFNBQ1pDLEtBQUt3QixPQUFPbkIsSUFBSXNELFVBQVUzRCxLQUFLOEIsSUFDL0I5QixLQUFLNEMsU0FHTkssWUFBWSxXQUNYLEdBQUtqRCxLQUFLeUIsU0FDVCxPQUFPekIsS0FFUkEsS0FBS3lCLFNBQVcsSUFBSTVCLEVBQ3BCRyxLQUFLeUIsU0FBUzFCLFNBQVNNLElBQUlFLFNBQVNQLEtBQUs4QixLQUUxQ3dCLGVBQWUsU0FBVTFDLEdBQ3hCLE9BQU9aLEtBQUt5QixXQUlaekIsS0FBS3lCLFNBQVNwQixJQUFJMkMsU0FDbEJoRCxLQUFLeUIsVUFBVyxHQUNUekIsUUFhVCxTQUFTNEQsRUFBa0JDLEdBQzFCLElBQUkvQixFQUVIZ0MsR0FEQUQsRUFBUUEsR0FHSXhELElBQUkwRCxHQUFHLGVBSXBCakMsRUFBSytCLEVBQU0xRSxFQUFFLHdCQUF3QjZFLElBQUksTUFNekNILEVBQU0xRSxFQUFFLG9CQUNOOEUsV0FDQUMsT0FBUSxXQUNSLE9BQXdCLEdBQWpCbEUsS0FBS21FLFdBRVpuQixVQUVGYyxFQUFPLElBQUl6RSxHQUNOVSxTQUNMK0QsRUFBS3pELElBQUlzRCxVQUFXRSxFQUFNMUUsRUFBRSxvQkFFNUJDLEVBQVcsSUFBSWtDLEVBQVksQ0FDMUJRLEdBQUlBLEtBRUkvQixTQUNUWCxFQUFTNEMsUUFDVDVDLEVBQVM2QyxHQUFHLHdCQUF5QixTQUFVc0IsR0FDOUNNLEVBQU05RCxPQUFPd0QsTUFJZixTQUFTYSxFQUFxQlAsR0FDN0IsSUFBSS9CLEVBQUsrQixFQUFNMUUsRUFBRSxxQkFBcUI2RSxJQUFJLElBQ3pDSCxFQUFRQSxHQUVJeEQsSUFBSTBELEdBQUcsZ0JBSXBCM0UsRUFBVyxJQUFJa0MsRUFBWSxDQUMxQlEsR0FBSUEsS0FFSS9CLFNBQ1RYLEVBQVM0QyxRQUNUNUMsRUFBUzZDLEdBQUcsd0JBQXlCLFNBQVVzQixHQUU5Q00sRUFBTVEsaUJBQ0xkLEVBQ3dCLFlBQXhCTSxFQUFNRyxJQUFJLFVBQTBCLE9BQUlNLE1BTzNDQyxJQUFJQyxVQUFXLHlCQUE0QlosR0FDM0NXLElBQUlDLFVBQVcsd0JBQTRCWixHQUMzQ1csSUFBSUMsVUFBVywyQkFBNEJKLEdBRzNDRyxJQUFJQyxVQUFXLDBCQUE2QlosR0FDNUNXLElBQUlDLFVBQVcseUJBQTZCWixHQUM1Q1csSUFBSUMsVUFBVyw0QkFBNkJKLEdBdk83QyxDQTBPR0ssT0FBUUMiLCJmaWxlIjoiYWNmLWRyb3B6b25lLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiggJCwgZHJvcHpvbmUgKXtcblx0Ly9cblx0Ly8gZHJvcHpvbmUuRHJvcGxvYWRlciA9IHdwLlVwbG9hZGVyLmV4dGVuZCh7XG5cdC8vIFx0aW5pdDogICAgIGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKGUpO1xuXHQvLyBcdH0sXG5cdC8vIFx0ZXJyb3I6ICAgIGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKGUpO1xuXHQvLyBcdH0sXG5cdC8vIFx0c3VjY2VzczogIGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKGUpO1xuXHQvLyBcdH0sXG5cdC8vIFx0YWRkZWQ6ICAgIGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKGUpO1xuXHQvLyBcdH0sXG5cdC8vIFx0cHJvZ3Jlc3M6IGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKGUpO1xuXHQvLyBcdH0sXG5cdC8vIFx0Y29tcGxldGU6IGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHRcdGNvbnNvbGUubG9nKGUpO1xuXHQvLyBcdH0sXG5cdC8vXG5cdC8vIH0pO1xuXG5cdHZhciBVcGxvYWRlckluZm8gPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTogICAnZGl2Jyxcblx0XHRjbGFzc05hbWU6ICdhY2YtZHJvcHpvbmUtaW5mbycsXG5cdFx0dGVtcGxhdGU6d3AudGVtcGxhdGUoJ2FjZi1kcm9wem9uZS1pbmZvJylcblx0fSk7XG5cdHZhciBQcm9ncmVzcyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0XHR0YWdOYW1lOiAgICdkaXYnLFxuXHRcdGNsYXNzTmFtZTogJ21lZGlhLXByb2dyZXNzLWJhci1ib3gnLFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuJHByb2dyZXNzID0gJCgnPGRpdiAvPicpLmFkZENsYXNzKCdtZWRpYS1wcm9ncmVzcy1iYXInKTtcblx0XHRcdHRoaXMuJGxhYmVsID0gJCgnPGRpdiAvPicpLmFkZENsYXNzKCdtZWRpYS1wcm9ncmVzcy1sYWJlbCcpO1xuXHRcdFx0dGhpcy4kYmFyID0gJCgnPGRpdiAvPicpO1xuXHRcdFx0dGhpcy4kZWxcblx0XHRcdFx0LmFwcGVuZCggdGhpcy4kbGFiZWwgKTtcblx0XHRcdHRoaXMuJHByb2dyZXNzXG5cdFx0XHRcdC5hcHBlbmQoIHRoaXMuJGJhciApXG5cdFx0XHRcdC5hcHBlbmRUbyggdGhpcy4kZWwgKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRzZXRMYWJlbDpmdW5jdGlvbihsYWJlbCkge1xuXHRcdFx0dGhpcy4kbGFiZWwudGV4dChsYWJlbCk7XG5cdFx0fSxcblx0XHRzZXRQcm9ncmVzczpmdW5jdGlvbiggcGVyY2VudCApIHtcblx0XHRcdHRoaXMuJGJhci53aWR0aCggKCBwZXJjZW50ICkrJyUnKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fSk7XG5cdHZhciBOb3RpY2UgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6d3AudGVtcGxhdGUoJ2FjZi1kcm9wem9uZS1ub3RpY2UnKSxcblx0XHRjbGFzc05hbWU6J25vdGljZSBpcy1kaXNtaXNzaWJsZScsXG5cdFx0ZXZlbnRzOntcblx0XHRcdCdjbGljayAubm90aWNlLWRpc21pc3MnIDogJ3JlbW92ZScsXG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0XHR0aGlzLiRlbC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMudHlwZSk7XG5cdFx0fVxuXHR9KVxuXG5cblx0dmFyIEFDRkRyb3B6b25lID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5ub3RpY2UgPSBmYWxzZTtcblx0XHRcdHRoaXMucHJvZ3Jlc3MgPSBmYWxzZTtcblx0XHRcdHRoaXMudXBsb2FkZXIgPSBuZXcgd3AubWVkaWEudmlldy5VcGxvYWRlcldpbmRvdyh7XG5cdFx0XHRcdGNvbnRyb2xsZXI6IHRoaXMsXG5cdFx0XHRcdHVwbG9hZGVyOiB7XG5cdFx0XHRcdFx0ZHJvcHpvbmU6ICB0aGlzLmVsLFxuXHRcdFx0XHRcdGNvbnRhaW5lcjogdGhpcy5lbCxcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCkge1xuXHRcdFx0JCggdGhpcy51cGxvYWRlci5yZW5kZXIoKS5lbCApLmFwcGVuZFRvKCB0aGlzLmVsICk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVhZHk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gcHJldmVudCBibG9jayBlZGl0b3IgZmlsZSBkcm9wXG5cdFx0XHR0aGlzLiRlbC5vbignZHJvcCBkcmFnZW50ZXIgZHJhZ2xlYXZlIGRyYWdvdmVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMudHJpZ2dlcignYWN0aXZhdGUnKVxuXHRcdFx0dGhpcy51cGxvYWRlci5yZWFkeSgpO1xuXHRcdFx0Ly9cblx0XHRcdHRoaXMudXBsb2FkZXIudXBsb2FkZXIudXBsb2FkZXIuYmluZCgnRmlsZXNBZGRlZCcsIHRoaXMuZmlsZXNBZGRlZCwgdGhpcyApO1xuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5iaW5kKCdCZWZvcmVVcGxvYWQnLCB0aGlzLmZpbGVCZWZvcmVVcGxvYWQsIHRoaXMgKTtcblx0XHRcdHRoaXMudXBsb2FkZXIudXBsb2FkZXIudXBsb2FkZXIuYmluZCgnVXBsb2FkUHJvZ3Jlc3MnLCB0aGlzLmZpbGVVcGxvYWRQcm9ncmVzcywgdGhpcyApO1xuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5iaW5kKCdGaWxlVXBsb2FkZWQnLCB0aGlzLmZpbGVVcGxvYWRlZCwgdGhpcyApO1xuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci51cGxvYWRlci5iaW5kKCdlcnJvcicsIHRoaXMuZmlsZVVwbG9hZEVycm9yLCB0aGlzICk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0ZmlsZXNBZGRlZDogZnVuY3Rpb24oIHVwbG9hZGVyLCBmaWxlcyApIHtcblx0XHRcdHRoaXMudG90YWwgPSBmaWxlcy5sZW5ndGg7XG5cdFx0XHR0aGlzLmRvbmUgPSAwO1xuXHRcdH0sXG5cdFx0ZmlsZUJlZm9yZVVwbG9hZDogZnVuY3Rpb24oIHVwbG9hZGVyLCBmaWxlICkge1xuXHRcdFx0ISEgdGhpcy5ub3RpY2UgJiYgdGhpcy5ub3RpY2UucmVtb3ZlKCk7XG5cdFx0XHR0aGlzLmFkZFByb2dyZXNzKCk7XG5cdFx0XHR0aGlzLnByb2dyZXNzLnNldExhYmVsKCBfLmVzY2FwZShmaWxlLm5hbWUpICk7XG5cdFx0XHR0aGlzLm5vdGljZSA9IGZhbHNlO1xuXHRcdH0sXG5cdFx0ZmlsZVVwbG9hZFByb2dyZXNzOmZ1bmN0aW9uKCB1cGxvYWRlciwgZmlsZSApIHtcblx0XHRcdHRoaXMuYWRkUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMucHJvZ3Jlc3Muc2V0UHJvZ3Jlc3MoICggMTAwICogdGhpcy5kb25lICsgZmlsZS5wZXJjZW50ICkgLyB0aGlzLnRvdGFsICk7XG5cdFx0fSxcblx0XHRmaWxlVXBsb2FkZWQ6ZnVuY3Rpb24oIHVwbG9hZGVyLCBmaWxlLCByZXNwb25zZSApIHtcblx0XHRcdHRoaXMuZG9uZSsrO1xuXHRcdFx0dGhpcy5maWxlID0gZmlsZTtcblx0XHRcdHRoaXMucmVtb3ZlUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMudHJpZ2dlcignYWNmLWRyb3B6b25lLXVwbG9hZGVkJyxmaWxlLmF0dGFjaG1lbnQpO1xuXHRcdH0sXG5cdFx0ZmlsZVVwbG9hZEVycm9yOmZ1bmN0aW9uKCB1cGxvYWRlciwgZXJyb3IgKSB7XG5cdFx0XHR0aGlzLmRvbmUrKztcblx0XHRcdHRoaXMucmVtb3ZlUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMudHJpZ2dlciggJ2FjZi1kcm9wem9uZS1lcnJvcicsIGVycm9yICk7XG5cblx0XHRcdHRoaXMubm90aWNlID0gbmV3IE5vdGljZSh7XG5cdFx0XHRcdHR5cGU6J2Vycm9yJyxcblx0XHRcdFx0Ym9sZDogXy5lc2NhcGUoZXJyb3IuZmlsZS5uYW1lKSxcblx0XHRcdFx0bWVzc2FnZTogZXJyb3IubWVzc2FnZVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLm5vdGljZS5yZW5kZXIoKTtcblx0XHRcdHRoaXMubm90aWNlLiRlbC5wcmVwZW5kVG8odGhpcy5lbCk7XG5cdFx0XHR0aGlzLnRvdGFsLS07XG5cdFx0fSxcblxuXHRcdGFkZFByb2dyZXNzOmZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCB0aGlzLnByb2dyZXNzICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMucHJvZ3Jlc3MgPSBuZXcgUHJvZ3Jlc3MoKTtcblx0XHRcdHRoaXMucHJvZ3Jlc3MucmVuZGVyKCkuJGVsLmFwcGVuZFRvKHRoaXMuZWwpO1xuXHRcdH0sXG5cdFx0cmVtb3ZlUHJvZ3Jlc3M6ZnVuY3Rpb24oIHBlcmNlbnQgKSB7XG5cdFx0XHRpZiAoICEgdGhpcy5wcm9ncmVzcyApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMucHJvZ3Jlc3MuJGVsLnJlbW92ZSgpO1xuXHRcdFx0dGhpcy5wcm9ncmVzcyA9IGZhbHNlO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0fSk7XG4vKlxuPGRpdiBpZD1cIm1lc3NhZ2VcIiBjbGFzcz1cIm5vdGljZSBpcy1kaXNtaXNzaWJsZVwiPlxuXHQ8cD5tc2c8L3A+XG5cdDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwibm90aWNlLWRpc21pc3NcIj5cblx0XHQ8c3BhbiBjbGFzcz1cInNjcmVlbi1yZWFkZXItdGV4dFwiPkRpc21pc3MgdGhpcyBub3RpY2UuPC9zcGFuPlxuXHQ8L2J1dHRvbj5cbjwvZGl2PlxuKi9cblxuXG5cdGZ1bmN0aW9uIGluaXRGaWxlRHJvcHpvbmUoIGZpZWxkICkge1xuXHRcdHZhciBlbCxcblx0XHRcdGZpZWxkID0gZmllbGQsXG5cdFx0XHRpbmZvO1xuXG5cdFx0aWYgKCAhIGZpZWxkLiRlbC5pcygnLmRyb3B6b25lJykgKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0ZWwgPSBmaWVsZC4kKCdbZGF0YS11cGxvYWRlcj1cIndwXCJdJykuZ2V0KDApXG5cblx0XHRpZiAoICEgZWwgKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE1NzEwNzYvcmVtb3ZlLXRleHQtd2l0aC1qcXVlcnlcblx0XHRmaWVsZC4kKCcuaGlkZS1pZi12YWx1ZT5wJylcblx0XHRcdC5jb250ZW50cygpXG5cdFx0XHQuZmlsdGVyKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMubm9kZVR5cGUgPT0gMzsgLy9Ob2RlLlRFWFRfTk9ERVxuXHRcdFx0fSlcblx0XHRcdC5yZW1vdmUoKTtcblxuXHRcdGluZm8gPSBuZXcgVXBsb2FkZXJJbmZvKCk7XG5cdFx0aW5mby5yZW5kZXIoKTtcblx0XHRpbmZvLiRlbC5wcmVwZW5kVG8oIGZpZWxkLiQoJy5oaWRlLWlmLXZhbHVlJykgKTtcblxuXHRcdGRyb3B6b25lID0gbmV3IEFDRkRyb3B6b25lKHtcblx0XHRcdGVsOiBlbCxcblx0XHR9KTtcblx0XHRkcm9wem9uZS5yZW5kZXIoKTtcblx0XHRkcm9wem9uZS5yZWFkeSgpO1xuXHRcdGRyb3B6b25lLm9uKCdhY2YtZHJvcHpvbmUtdXBsb2FkZWQnLCBmdW5jdGlvbiggYXR0YWNobWVudCApe1xuXHRcdFx0ZmllbGQucmVuZGVyKGF0dGFjaG1lbnQpO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gaW5pdEdhbGxlcnlEcm9wem9uZSggZmllbGQgKSB7XG5cdFx0dmFyIGVsID0gZmllbGQuJCgnLmFjZi1nYWxsZXJ5LW1haW4nKS5nZXQoMCksXG5cdFx0XHRmaWVsZCA9IGZpZWxkO1xuXG5cdFx0aWYgKCAhIGZpZWxkLiRlbC5pcygnLmRyb3B6b25lJykgKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0ZHJvcHpvbmUgPSBuZXcgQUNGRHJvcHpvbmUoe1xuXHRcdFx0ZWw6IGVsLFxuXHRcdH0pO1xuXHRcdGRyb3B6b25lLnJlbmRlcigpO1xuXHRcdGRyb3B6b25lLnJlYWR5KCk7XG5cdFx0ZHJvcHpvbmUub24oJ2FjZi1kcm9wem9uZS11cGxvYWRlZCcsIGZ1bmN0aW9uKCBhdHRhY2htZW50ICl7XG5cblx0XHRcdGZpZWxkLmFwcGVuZEF0dGFjaG1lbnQoXG5cdFx0XHRcdGF0dGFjaG1lbnQsXG5cdFx0XHRcdGZpZWxkLmdldCgnaW5zZXJ0JykgPT09ICdwcmVwZW5kJyA/IDAgOiB1bmRlZmluZWRcblx0XHRcdCk7XG5cblx0XHR9KTtcblx0fVxuXG5cblx0YWNmLmFkZEFjdGlvbiggJ3JlYWR5X2ZpZWxkL3R5cGU9aW1hZ2UnLCAgIGluaXRGaWxlRHJvcHpvbmUgKTtcblx0YWNmLmFkZEFjdGlvbiggJ3JlYWR5X2ZpZWxkL3R5cGU9ZmlsZScsICAgIGluaXRGaWxlRHJvcHpvbmUgKTtcblx0YWNmLmFkZEFjdGlvbiggJ3JlYWR5X2ZpZWxkL3R5cGU9Z2FsbGVyeScsIGluaXRHYWxsZXJ5RHJvcHpvbmUgKTtcblxuXHQvLyBjcmVhdGVkIGZyb20gcmVwZWF0ZXJcblx0YWNmLmFkZEFjdGlvbiggJ2FwcGVuZF9maWVsZC90eXBlPWltYWdlJywgICBpbml0RmlsZURyb3B6b25lICk7XG5cdGFjZi5hZGRBY3Rpb24oICdhcHBlbmRfZmllbGQvdHlwZT1maWxlJywgICAgaW5pdEZpbGVEcm9wem9uZSApO1xuXHRhY2YuYWRkQWN0aW9uKCAnYXBwZW5kX2ZpZWxkL3R5cGU9Z2FsbGVyeScsIGluaXRHYWxsZXJ5RHJvcHpvbmUgKTtcblxuXG59KShqUXVlcnksIGFjZl9kcm9wem9uZSApO1xuIl19
